<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Perangkat Ajar Kelas 8 | MTsT Daarut Tahfizh Al-Ikhlas</title>
  <meta name="description" content="Koleksi digital perangkat ajar Bahasa Inggris Kelas 8 — Kurikulum Merdeka 2025/2026">
  <meta name="theme-color" content="#ea580c">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    :root {
      --bg: #f9fafb; --card: #ffffff; --text: #1e293b; --text-light: #475569;
      --accent: #ea580c; --accent-light: #fdba74; --accent-dark: #c2410c;
      --success: #10b981; --success-dark: #059669; --border: #e2e8f0;
      --shadow: 0 10px 30px rgba(30, 41, 59, 0.08);
      --shadow-hover: 0 20px 40px rgba(30, 41, 59, 0.15);
      --radius: 18px; --radius-sm: 12px; --gap: 24px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --font-body: 'Inter', sans-serif; --font-title: 'Playfair Display', serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font-body); background: var(--bg); color: var(--text); line-height: 1.7; min-height: 100vh; padding-bottom: 80px; }
    .app { max-width: 1200px; margin: 0 auto; padding: 32px 20px; }

    /* Hero */
    .hero {
      text-align: center; padding: 56px 32px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white; border-radius: var(--radius); margin-bottom: 48px; position: relative; overflow: hidden;
      box-shadow: var(--shadow);
    }
    .hero::before {
      content: ''; position: absolute; inset: 0;
      background: radial-gradient(circle at 20% 30%, rgba(234, 88, 12, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 70%, rgba(253, 186, 116, 0.05) 0%, transparent 50%);
      opacity: 0.6; animation: float 25s infinite linear; z-index: -1;
    }
    @keyframes float { from { transform: translateY(0) rotate(0deg); } to { transform: translateY(-100px) rotate(1deg); } }
    .hero h1 { font-family: var(--font-title); font-size: clamp(2.2rem, 4vw, 3rem); font-weight: 700; margin-bottom: 12px; }
    .tagline { font-size: clamp(1.1rem, 2vw, 1.3rem); opacity: 0.95; margin-bottom: 20px; }
    .info { display: flex; justify-content: center; gap: 32px; flex-wrap: wrap; font-size: 0.95rem; opacity: 0.9; margin-bottom: 8px; }
    .info div { display: flex; align-items: center; gap: 8px; }
    .info i { color: var(--accent-light); }
    .stats { display: flex; justify-content: center; gap: 48px; margin-top: 32px; flex-wrap: wrap; }
    .stat { text-align: center; position: relative; }
    .stat::after { content: ''; position: absolute; right: -24px; top: 50%; transform: translateY(-50%); width: 1px; height: 40px; background: rgba(255, 255, 255, 0.2); }
    .stat:last-child::after { display: none; }
    .stat strong { display: block; font-size: clamp(1.8rem, 3vw, 2.2rem); font-weight: 700; color: var(--accent-light); margin-bottom: 4px; }
    .stat span { font-size: 0.9rem; opacity: 0.85; }

    /* Search */
    .search-container { position: relative; max-width: 680px; margin: 0 auto 36px; }
    .search { width: 100%; padding: 18px 60px 18px 24px; font-size: 1.1rem; border: 2px solid var(--border); 
              border-radius: var(--radius); background: var(--card); box-shadow: var(--shadow); transition: var(--transition); }
    .search:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 4px rgba(234, 88, 12, 0.15), var(--shadow); transform: translateY(-2px); }
    .search-icon { position: absolute; right: 24px; top: 50%; transform: translateY(-50%); color: var(--accent); font-size: 1.3rem; pointer-events: none; }

    /* Categories */
    .categories { display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; margin-bottom: 36px; }
    .cat-chip { padding: 12px 20px; background: var(--card); border: 2px solid var(--border); border-radius: 50px; 
                font-size: 0.9rem; font-weight: 600; color: var(--text-light); display: flex; align-items: center; gap: 8px; 
                transition: var(--transition); box-shadow: 0 2px 8px rgba(0,0,0,0.04); cursor: pointer; }
    .cat-chip i { color: var(--accent); }
    .cat-chip:hover, .cat-chip.active { border-color: var(--accent); color: var(--accent); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(234, 88, 12, 0.15); }
    .cat-chip.active { background: var(--accent); color: white; border-color: var(--accent); }
    .cat-chip.active i { color: white; }

    /* Document List */
    .list { display: grid; gap: var(--gap); grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); }
    .item { background: var(--card); border-radius: var(--radius); padding: 24px; display: flex; flex-direction: column; gap: 16px; 
            border: 2px solid transparent; box-shadow: var(--shadow); transition: var(--transition); cursor: pointer; position: relative; overflow: hidden; }
    .item::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--accent-light)); 
                    transform: scaleX(0); transition: transform 0.3s ease; }
    .item:hover { transform: translateY(-6px); box-shadow: var(--shadow-hover); border-color: var(--accent-light); }
    .item:hover::before { transform: scaleX(1); }
    .item-title { font-weight: 600; font-size: 1.2rem; color: var(--text); margin-bottom: 12px; line-height: 1.4; 
                  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .item-meta { display: flex; gap: 16px; font-size: 0.88rem; color: var(--text-light); flex-wrap: wrap; }
    .item-meta span { display: flex; align-items: center; gap: 6px; background: var(--bg); padding: 4px 10px; border-radius: 20px; font-weight: 500; }
    .item-meta i { color: var(--accent); font-size: 0.8rem; }
    .item-actions { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }

    /* Buttons */
    .btn { padding: 12px 18px; border-radius: var(--radius-sm); font-size: 0.88rem; font-weight: 600; cursor: pointer; 
           transition: var(--transition); display: flex; align-items: center; gap: 6px; white-space: nowrap; min-width: 100px; 
           justify-content: center; border: 2px solid transparent; text-decoration: none; }
    .btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    .btn-primary { background: var(--accent); color: white; border-color: var(--accent); }
    .btn-primary:hover { background: var(--accent-dark); border-color: var(--accent-dark); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(234, 88, 12, 0.3); }
    .btn-ghost { background: transparent; color: var(--text-light); border-color: var(--border); }
    .btn-ghost:hover { border-color: var(--accent); color: var(--accent); transform: translateY(-2px); }
    .highlight { background: #fed7aa; color: #c2410c; padding: 2px 6px; border-radius: 4px; font-weight: 600; }

    /* Explore Hint */
    .explore-hint { text-align: center; margin: 48px 0 24px; padding: 24px; color: var(--text-light); font-size: 1.05rem; 
                    font-weight: 500; background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); border-left: 4px solid var(--accent); }
    .explore-hint i { color: var(--accent); margin-right: 10px; animation: bounce 2s infinite; }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }

    /* Empty State */
    .empty { text-align: center; padding: 80px 20px; color: var(--text-light); background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); display: none; }
    .empty i { font-size: 4rem; color: #cbd5e1; margin-bottom: 20px; opacity: 0.6; }
    .empty p { font-size: 1.2rem; max-width: 520px; margin: 0 auto; font-weight: 500; }

    /* Toast */
    .toast {
      position: fixed; top: 24px; right: 24px; padding: 16px 20px; background: var(--success); color: white;
      border-radius: var(--radius-sm); box-shadow: var(--shadow-hover);
      transform: translateX(400px); opacity: 0; pointer-events: none;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 10000; display: flex; align-items: center; gap: 8px; font-weight: 600;
    }
    .toast.show {
      transform: translateX(0); opacity: 1; pointer-events: auto;
    }

    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.92); backdrop-filter: blur(20px); 
             display: none; align-items: center; justify-content: center; padding: 20px; z-index: 1000; opacity: 0; transition: opacity 0.3s ease; }
    .modal.open { display: flex; opacity: 1; }
    .viewer { width: 100%; max-width: 1200px; height: 85vh; background: white; border-radius: var(--radius); overflow: hidden; 
              display: flex; flex-direction: column; box-shadow: 0 40px 80px rgba(0,0,0,0.4); transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .modal.open .viewer { transform: scale(1); }
    .bar { padding: 20px 28px; background: #f8fafc; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; gap: 16px; flex-wrap: wrap; }
    .modal-title { font-weight: 600; font-size: 1.25rem; color: var(--text); }
    .modal-meta { color: var(--text-light); font-size: 0.95rem; margin-top: 4px; }
    iframe { flex: 1; border: 0; background: white; }

    /* Footer */
    footer { margin-top: 80px; padding: 40px 20px 32px; background: linear-gradient(to top, #f1f5f9 0%, transparent 100%); 
             border-top: 1px solid var(--border); text-align: center; color: var(--text-light); font-size: 0.95rem; position: relative; }
    footer::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 120px; height: 3px; 
                     background: linear-gradient(90deg, transparent, var(--accent), transparent); }
    .signature { font-weight: 700; color: var(--text); font-size: 1.15rem; margin-bottom: 8px; }
    .role { font-size: 1rem; margin-bottom: 6px; font-weight: 500; }
    .system { margin-top: 24px; font-size: 0.9rem; color: var(--accent); font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; }

    /* Responsive */
    @media (max-width: 768px) {
      .app { padding: 24px 16px; }
      .hero { padding: 40px 24px; margin-bottom: 40px; }
      .hero h1 { font-size: 2rem; }
      .info { gap: 24px; font-size: 0.9rem; }
      .stats { gap: 32px; }
      .stat::after { right: -16px; height: 30px; }
      .list { grid-template-columns: 1fr; gap: 20px; }
      .item { padding: 20px; }
      .item-actions { flex-direction: column; width: 100%; gap: 14px; }
      .item-actions .btn { width: 100%; font-size: 0.9rem; padding: 15px 16px; }
      .categories { gap: 12px; }
      .cat-chip { padding: 10px 16px; font-size: 0.85rem; }
      .search { padding: 16px 56px 16px 20px; font-size: 1rem; }
      .bar { padding: 16px 20px; flex-direction: column; gap: 12px; text-align: center; }
      .viewer { height: 90vh; }
    }

    @media (max-width: 480px) {
      .hero { padding: 32px 20px; }
      .hero h1 { font-size: 1.8rem; }
      .info { flex-direction: column; gap: 12px; }
      .stats { gap: 24px; }
      .stat::after { display: none; }
      .item-meta { flex-direction: column; gap: 8px; }
      .explore-hint { margin: 32px 0 20px; padding: 20px; font-size: 1rem; }
      .empty { padding: 60px 20px; }
      .empty i { font-size: 3.2rem; }
      .empty p { font-size: 1.1rem; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
      .hero::before, .explore-hint i { animation: none !important; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="hero">
      <h1>Perangkat Ajar Kelas 8</h1>
      <div class="tagline">Bahasa Inggris • Kurikulum Merdeka 2025/2026</div>
      <div class="info">
        <div><i class="fas fa-user"></i> Ahmad Zaman Huri</div>
        <div><i class="fas fa-school"></i> MTsT Daarut Tahfizh Al-Ikhlas</div>
      </div>
      <div class="stats">
        <div class="stat"><strong id="total-files">21</strong><span>Dokumen</span></div>
        <div class="stat"><strong id="total-views">0</strong><span>Dilihat</span></div>
        <div class="stat"><strong>5</strong><span>Kategori</span></div>
      </div>
    </header>

    <div class="search-container">
      <input type="text" class="search" id="search" placeholder="Cari dari 21 dokumen yang tersedia..." autocomplete="off">
      <i class="fas fa-search search-icon"></i>
    </div>

    <div class="categories" id="categories">
      <div class="cat-chip active" data-category="all"><i class="fas fa-layer-group"></i> Semua</div>
      <div class="cat-chip" data-category="Asesmen"><i class="fas fa-clipboard-check"></i> Asesmen</div>
      <div class="cat-chip" data-category="Dokumen Inti"><i class="fas fa-file-alt"></i> Dokumen Inti</div>
      <div class="cat-chip" data-category="Materi & Aktivitas"><i class="fas fa-book-open"></i> Materi & Aktivitas</div>
      <div class="cat-chip" data-category="Modul Ajar"><i class="fas fa-puzzle-piece"></i> Modul Ajar</div>
      <div class="cat-chip" data-category="Template"><i class="fas fa-copy"></i> Template</div>
    </div>

    <main>
      <div id="list" class="list"></div>
      <div class="explore-hint" id="explore-hint">
        <i class="fas fa-search"></i>Gunakan kolom pencarian untuk menemukan lebih dari 21 dokumen yang tersedia...
      </div>
      <div id="empty" class="empty">
        <i class="fas fa-file-search"></i>
        <p>Tidak ada dokumen yang sesuai dengan pencarian Anda.</p>
      </div>
    </main>

    <footer>
      <div class="signature">Dibuat & Dikelola oleh</div>
      <div class="role">Ahmad Zaman Huri — Guru Bahasa Inggris</div>
      <div>MTsT Daarut Tahfizh Al-Ikhlas</div>
      <div class="system">Paperless Teaching System</div>
    </footer>
  </div>

  <div id="toast" class="toast" aria-live="polite">
    <i class="fas fa-check-circle"></i><span id="toast-message">Pesan WA siap!</span>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="viewer">
      <div class="bar">
        <div>
          <strong class="modal-title" id="modal-title">Preview</strong>
          <div class="modal-meta" id="modal-meta"></div>
        </div>
        <div>
          <button class="btn btn-ghost" id="open-new"><i class="fas fa-external-link-alt"></i> Buka</button>
          <button class="btn btn-primary" id="close"><i class="fas fa-times"></i> Tutup</button>
        </div>
      </div>
      <iframe id="viewer-frame" title="Document Preview" src="about:blank" loading="lazy"></iframe>
    </div>
  </div>

  <script>
    const files = [
      {id:1, title:'PAS - Soal & Kunci (PAS Genap)', folder:'Asesmen', link:'https://docs.google.com/document/d/e/2PACX-1vQTdjhzjlsNRdDjPpnkFHsHPlFqeTA7xWReAFlx6nteeUEyDNTz9bitrIY6Hpg4u56SiPIz9gR1dgdS/pub', type:'Google Doc'},
      {id:2, title:'PTS - Soal PTS Ganjil', folder:'Asesmen', link:'https://docs.google.com/document/d/e/2PACX-1vSc3E8AdatkHSCWuNp9O1WjlFArczoEQhiCJFIX5G_UxqDz4h7d86N9nvfDuNtADsSjaXmga2JzmXOH/pub', type:'Google Doc'},
      {id:3, title:'ATP - Alur Tujuan Pembelajaran', folder:'Dokumen Inti', link:'https://docs.google.com/document/d/e/2PACX-1vSlob00jaPIYR4x9G0kU_GhuZXlFtImnQHhDsqgbn2kEAdcyb7poKBstmj0INDiLpE56aU_2ZD6NmEo/pub', type:'Google Doc'},
      {id:4, title:'CP - Capaian Pembelajaran', folder:'Dokumen Inti', link:'https://docs.google.com/document/d/e/2PACX-1vRFZlhzcSpTqTjqVuM7SVJbVC0B_2zer9IAoq2oWlbKZCasCTaVBcMtGHUikrn0TuHuAOkkf_E3bg0f/pub', type:'Google Doc'},
      {id:5, title:'PROTA - Program Tahunan', folder:'Dokumen Inti', link:'https://docs.google.com/document/d/e/2PACX-1vT5T60Yva6u_t1XuuSZ7mrmuGVHbAwoHOpbX4MLuyTPLKHHk35S-BvUumeHBJECzpx9GXdleps_OdEB/pub', type:'Google Doc'},
      {id:6, title:'PROMES - Program Semester Ganjil', folder:'Dokumen Inti', link:'https://docs.google.com/document/d/e/2PACX-1vSZrAjlkPMjwtAQD9LycEPHBgxc6Y_IGwd-BcnBkitXRvaa-iUc-YppIYZib6e8B0q_55p2Ongc7qBX/pub', type:'Google Doc'},
      {id:7, title:'PROMES - Program Semester Genap', folder:'Dokumen Inti', link:'https://docs.google.com/document/d/e/2PACX-1vRky_-ShK2qndqzH5DpoJVDn3znJ94UtFSPsZySg4asr-a3xTbotRDiAiQO3sHkmA1LnwbRiC0PIV5Z/pub', type:'Google Doc'},
      {id:8, title:'TP - Tujuan Pembelajaran per Chapter', folder:'Dokumen Inti', link:'https://docs.google.com/document/d/e/2PACX-1vTkmYcR_93DhhIEVJj5urA3p69kUAxjPRWpXgh_bgLLbAChVZqRdLOcWhMq8MmQSfuv0U-wcqy24iEn/pub', type:'Google Doc'},
      {id:9, title:'Game & Ice Breaking per Chapter', folder:'Materi & Aktivitas', link:'https://docs.google.com/document/d/e/2PACX-1vRS8RgVthWD-KSsSajbbwIJIcMAwLB2OTea8Twq54mKPHQpZEM6mu1R4RENZ9eaTBE0hxk65D7RMFXb/pub', type:'Google Doc'},
      {id:10, title:'Grammar Summary per Chapter', folder:'Materi & Aktivitas', link:'https://docs.google.com/document/d/e/2PACX-1vSsf6gs4sE-pKSv-0ZDrqY72EtUFnStdwjDBQHWAIPB7CdoxAbamykX3ToCchSX0sBRXPdCKoGSnt-H/pub', type:'Google Doc'},
      {id:11, title:'Slide PPT per Chapter (PDF converted)', folder:'Materi & Aktivitas', link:'https://docs.google.com/document/d/e/2PACX-1vRws5zTbghGBwElKJBer7WB7RxlPqyKp31mUaKPbpWk0sHRWwWEfUR3Vzhhwk_D_koGA667dffqCEed/pub', type:'Google Doc'},
      {id:12, title:'Vocabulary List per Chapter', folder:'Materi & Aktivitas', link:'https://docs.google.com/document/d/e/2PACX-1vSN_o0ItI0t2AIJOE4CGN47wpNbSUXQ8DtbHNwqgilzeaZ7bpyMDOxCGvk3DNvCjObfSrmmlpFUMWUH/pub', type:'Google Doc'},
      {id:13, title:'Worksheet & Task per Chapter', folder:'Materi & Aktivitas', link:'https://docs.google.com/document/d/e/2PACX-1vQmHihzfIcL0hKjG3hFDpn5mzYQv1MGmj8b1LK93b4vYiS0KxLjxKfQfbHLKBO3zCtGsn13hyVjhwjF/pub', type:'Google Doc'},
      {id:14, title:'Modul Ajar - Chapter 1', folder:'Modul Ajar', link:'https://docs.google.com/document/d/e/2PACX-1vTebz4cVyBt4HW3dv19EySBPxUZw_0KnC1aRaJsw6FUic5Piwgcb_Yo498ICoaV9xmlQP5fhvcP3L1S/pub', type:'Google Doc'},
      {id:15, title:'Modul Ajar - Chapter 2', folder:'Modul Ajar', link:'https://docs.google.com/document/d/e/2PACX-1vQTlTfpx20M6sp_rbhHFK-gMXFpUc7MYUW5XdmtcPK6dsS-7T225gAomfWwo3dlpF1xsxmE_Uzc4Zd4/pub', type:'Google Doc'},
      {id:16, title:'Modul Ajar - Chapter 3', folder:'Modul Ajar', link:'https://docs.google.com/document/d/e/2PACX-1vQTdaWHcrE46hgxEhj9uizTAHC3o-qimmKVwoKl64Nb9V_VoVhwA0yIDEf3OpbfKQAHV5hRu_P34SUa/pub', type:'Google Doc'},
      {id:17, title:'Modul Ajar - Chapter 4', folder:'Modul Ajar', link:'https://docs.google.com/document/d/e/2PACX-1vTHRslW19pZRILi7mXtPbphlUV6KybY07SPHUdHxKIQ6w896Gq-MRM6uQlUcOL__GvLB9NbpB-sGmuB/pub', type:'Google Doc'},
      {id:18, title:'Modul Ajar - Chapter 5', folder:'Modul Ajar', link:'https://docs.google.com/document/d/e/2PACX-1vSb3zGM6hM9j4uiCMOZOEwo3CS6EaJDDcdYTRWuSV9jduoRdJveGf6HZYPI8xGNZdKzfJ8bjxRzG6MS/pub', type:'Google Doc'},
      {id:19, title:'Template Modul Ajar', folder:'Template', link:'https://docs.google.com/document/d/e/2PACX-1vQRuGu7kTu31SQ5eayrW7uHSEpODbj_dTFFHQkVDL7tW8ueY2g5pywuflGaNt-2A6FO_fd0njSsGLnO/pub', type:'Google Doc'},
      {id:20, title:'Template Rubrik Penilaian', folder:'Template', link:'https://docs.google.com/document/d/e/2PACX-1vQ4JoGQW10U6HJ4MTnykUkRhZFblDlxZZ5o8nvEWRAYDFQPHZq8DGc8QAJktBpEA0fmTCzRen91B_sT/pub', type:'Google Doc'},
      {id:21, title:'Template Worksheet', folder:'Template', link:'https://docs.google.com/document/d/e/2PACX-1vQwggnm3yDR6h_A8xWixlEMPX8dLjiOypEzqDCA-BXD8_DI5Ak6WJJGxxivaGg_Qz1XELpw-q7i0_p-/pub', type:'Google Doc'}
    ];

    // Initialize
    files.forEach(f => {
      const key = `view:${f.link}`;
      const saved = localStorage.getItem(key);
      f.views = saved ? parseInt(saved, 10) : Math.floor(Math.random() * 400) + 80;
      localStorage.setItem(key, f.views);
    });

    const elements = {
      list: document.getElementById('list'), empty: document.getElementById('empty'), search: document.getElementById('search'),
      modal: document.getElementById('modal'), frame: document.getElementById('viewer-frame'), modalTitle: document.getElementById('modal-title'),
      modalMeta: document.getElementById('modal-meta'), totalFiles: document.getElementById('total-files'), 
      totalViews: document.getElementById('total-views'), exploreHint: document.getElementById('explore-hint'),
      categories: document.getElementById('categories'), toast: document.getElementById('toast'), 
      toastMessage: document.getElementById('toast-message'), toastTimeout: null
    };

    let currentLink = '';
    let currentCategory = 'all';
    let currentSearch = '';
    let isSearching = false;

    elements.totalFiles.textContent = files.length;
    elements.totalViews.textContent = files.reduce((a,b) => a + b.views, 0).toLocaleString();
    renderInitialFiles();

    // Event Listeners
    let searchTimeout;
    elements.search.addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        currentSearch = e.target.value.trim();
        isSearching = currentSearch.length > 0;
        renderFiles();
      }, 300);
    });

    elements.categories.addEventListener('click', (e) => {
      const chip = e.target.closest('.cat-chip');
      if (!chip) return;
      document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      currentCategory = chip.dataset.category;
      isSearching = true;
      renderFiles();
    });

    document.getElementById('close').addEventListener('click', closeModal);
    document.getElementById('open-new').addEventListener('click', () => window.open(currentLink, '_blank'));
    elements.modal.addEventListener('click', (e) => { if (e.target === elements.modal) closeModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && elements.modal.classList.contains('open')) closeModal(); });

    // Functions
    function highlightText(text, query) {
      if (!query) return text;
      const regex = new RegExp(`(${query})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }

    function renderInitialFiles() {
      const initialFiles = files.slice(0, 6);
      renderFileList(initialFiles);
      elements.exploreHint.style.display = 'block';
    }

    function renderFiles() {
      if (!isSearching && currentCategory === 'all') {
        renderInitialFiles();
        return;
      }

      const filtered = files.filter(f => {
        const matchesCategory = currentCategory === 'all' || f.folder === currentCategory;
        const matchesSearch = !currentSearch || 
          f.title.toLowerCase().includes(currentSearch.toLowerCase()) || 
          f.folder.toLowerCase().includes(currentSearch.toLowerCase());
        return matchesCategory && matchesSearch;
      });

      renderFileList(filtered);
    }

    function renderFileList(fileList) {
      elements.list.innerHTML = '';
      if (!fileList.length) {
        elements.empty.style.display = 'block';
        elements.exploreHint.style.display = 'none';
        return;
      }

      elements.empty.style.display = 'none';
      
      fileList.forEach(file => {
        const el = document.createElement('div');
        el.className = 'item';
        const highlightedTitle = highlightText(file.title, currentSearch);

        el.innerHTML = `
          <div class="item-content">
            <div class="item-title">${highlightedTitle}</div>
            <div class="item-meta">
              <span><i class="fas fa-folder"></i> ${file.folder}</span>
              <span><i class="fas fa-eye"></i> ${file.views} dilihat</span>
              <span><i class="fas fa-file-lines"></i> ${file.type}</span>
            </div>
          </div>
          <div class="item-actions">
            <button class="btn btn-primary" data-action="preview"><i class="fas fa-eye"></i> Preview</button>
            <button class="btn btn-ghost" data-action="wa"><i class="fab fa-whatsapp"></i> Minta via WA</button>
          </div>
        `;

        el.querySelector('[data-action="preview"]').addEventListener('click', (e) => {
          e.stopPropagation();
          openPreview(file);
        });

        el.querySelector('[data-action="wa"]').addEventListener('click', (e) => {
          e.stopPropagation();
          const message = encodeURIComponent(`Halo Pak Ahmad, saya ingin mendapatkan:\n"${file.title}"\n(Kelas 8 - ${file.folder})`);
          window.open(`https://wa.me/6282246077307?text=${message}`, '_blank');
          showToast('Pesan WA siap dikirim!');
        });

        el.addEventListener('click', () => openPreview(file));
        elements.list.appendChild(el);
      });

      elements.exploreHint.style.display = (!isSearching && currentCategory === 'all' && fileList.length <= 6) ? 'block' : 'none';
    }

    function openPreview(file) {
      elements.modal.classList.add('open');
      elements.modal.setAttribute('aria-hidden', 'false');
      elements.modalTitle.textContent = file.title;
      elements.modalMeta.textContent = `${file.folder} • ${file.type}`;
      currentLink = file.link;
      elements.frame.src = file.link;
      
      file.views++;
      localStorage.setItem(`view:${file.link}`, file.views);
      elements.totalViews.textContent = files.reduce((a,b) => a + b.views, 0).toLocaleString();
    }

    function closeModal() {
      elements.modal.classList.remove('open');
      elements.modal.setAttribute('aria-hidden', 'true');
      elements.frame.src = 'about:blank';
    }

    function showToast(message) {
      elements.toastMessage.textContent = message;
      elements.toast.classList.add('show');
      clearTimeout(elements.toastTimeout);
      elements.toastTimeout = setTimeout(() => {
        elements.toast.classList.remove('show');
      }, 2500);
    }
  </script>
</body>
</html>
